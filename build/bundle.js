!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=36)}([function(e,t){e.exports=require("react")},function(e,t){e.exports={role:{ADMIN:"Admin",USER:"User"},tokenType:{ACCESS_TOKEN:"ACCESS_TOKEN",REFRESH_TOKEN:"REFRESH_TOKEN"},accountState:{ACTIVE:"Active",PENDING:"Pending",SUSPENDED:"Suspended",DELETED:"Deleted"}}},function(e,t){e.exports=require("passport")},function(e,t){e.exports=require("express")},function(e,t,n){var r=n(10).MongoClient;e.exports={connect:function(e,t,n){if(o.db)return n();r.connect(e,(function(e,r){if(e)return n(e);o.db=r.db(t),n()}))},get:function(){return o.db},close:function(e){o.db&&o.db.close((function(t,n){o.db=null,e(t)}))}};var o={db:null}},function(e,t){e.exports=require("react-router-dom")},function(e,t){e.exports=require("react-router-config")},function(e,t){e.exports=require("redux")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("mongodb")},function(e){e.exports=JSON.parse('{"secret":"9982","oauth_callback":"","oauth_twitter_key":"","oauth_twitter_secret":"","oauth_twitter_access_url":"","authentication_token_secret":"7860aYrRANrEfciTsi0APdq6CRCQCwIk"}')},function(e,t,n){"use strict";n.r(t),n.d(t,"generateAccessToken",(function(){return a})),n.d(t,"generateRefreshToken",(function(){return i}));var r=n(30),o=n(11),u=n(1).tokenType,a=function(e){return s(e,u.ACCESS_TOKEN)},i=function(e){return s(e,u.REFRESH_TOKEN)},s=function(e,t){var n=o.authentication_token_secret;return r.sign({type:t},n,{expiresIn:1800,subject:JSON.stringify(e)})}},function(e,t,n){function r(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},u=Object.keys(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function o(e,t,n,r,o,u,a){try{var i=e[u](a),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,u){var a=e.apply(t,n);function i(e){o(a,r,u,i,s,"next",e)}function s(e){o(a,r,u,i,s,"throw",e)}i(void 0)}))}}n(1).roles;var a=n(4);function i(){return(i=u(regeneratorRuntime.mark((function e(t,n){var o,u,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get().collection("users").find({email:t,password:n}).toArray();case 2:if(!((o=e.sent).length>=1)){e.next=7;break}return u=o[0],u.password,i=r(u,["password"]),e.abrupt("return",i);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function s(){return(s=u(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get().collection("refresh_tokens").remove({refresh_token:t});case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function c(){return(c=u(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=3;break}return e.next=3,deleteRequestToken(n);case 3:return e.next=5,a.get().collection("refresh_tokens").insertOne({userId:t,refresh_token:r});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(){return(l=u(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.get().collection("refresh_tokens").findOne({userId:t,refresh_token:n});case 2:if(e.sent){e.next=5;break}return e.abrupt("return",!1);case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports={authenticate:function(e,t){return i.apply(this,arguments)},deleteRefreshToken:function(e){return s.apply(this,arguments)},updateRefreshToken:function(e,t,n){return c.apply(this,arguments)},isValidRefreshToken:function(e,t){return l.apply(this,arguments)}}},function(e,t){e.exports=require("express-jwt")},function(e,t,n){function r(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},u=Object.keys(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(e);for(r=0;r<u.length;r++)n=u[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function o(e,t,n,r,o,u,a){try{var i=e[u](a),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(r,u){var a=e.apply(t,n);function i(e){o(a,r,u,i,s,"next",e)}function s(e){o(a,r,u,i,s,"throw",e)}i(void 0)}))}}var a=n(1).role,i=n(4),s=(n(32),n(10).ObjectID);function c(){return(c=u(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.get().collection("users").find().toArray();case 2:return(t=e.sent).map((function(e){e.password;return r(e,["password"])})),e.abrupt("return",t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(){return(l=u(regeneratorRuntime.mark((function e(t){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.get().collection("users").findOne({_id:new s(t)});case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:return n.password,o=r(n,["password"]),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return(f=u(regeneratorRuntime.mark((function e(t,n,r,o,u){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.get().collection("users").insertOne({joined_date:new Date,friends:[],favorite_sorters:[],sorter_history:[],profile:{username:t,about_me:"",links_list:[],share_settings:{},icon:o},email:n,password:r,integration3rdparty:[],role:a.User,account_status:u});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return(p=u(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.get().collection("users").updateOne({_id:t},{$set:n});case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}e.exports={getAll:function(){return c.apply(this,arguments)},getById:function(e){return l.apply(this,arguments)},createUser:function(e,t,n,r,o){return f.apply(this,arguments)},updateUser:function(e,t){return p.apply(this,arguments)}}},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("morgan")},function(e,t){e.exports=function(e,t,n,r){if("string"==typeof e)return n.status(400).json({message:e});if("UnauthorizedError"===e.name)return n.status(401).json({message:e.message&&e.message.length?e.message:"Invalid Token"});return n.status(500).json({message:e.message})}},function(e,t){e.exports=require("react-dom/server")},function(e,t){e.exports=require("react-redux")},function(e,t){e.exports=require("serialize-javascript")},function(e,t){e.exports=require("react-helmet")},function(e,t){e.exports=require("react-twitter-auth")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("@babel/polyfill")},function(e,t,n){var r=n(2),o=n(28).Strategy,u=n(29).Strategy,a=n(1).tokenType,i=n(11).authentication_token_secret,s=(n(12),n(13)),c=n(14).UnauthorizedError;r.use("jwt",new o({secretOrKey:i,jwtFromRequest:function(e){if(!e.headers.authorization)throw new c(401,{message:"Access token not provided."});return e.headers.authorization.replace("Bearer ","").trim()}},(function(e,t){try{if(e.type!==a.ACCESS_TOKEN)throw new c(401,{message:"Access token not provided."});t(null,JSON.parse(e.sub))}catch(e){console.error("Token is not valid:",e.message),t(e)}}))),r.use("login",new u({usernameField:"email",passwordField:"password"},(function(e,t,n){s.authenticate(e,t).then((function(e){return e?n(null,e,{message:"Login successful."}):n(null,!1,{message:"Username or password is incorrect."})})).catch((function(e){return n(e)}))})))},function(e,t){e.exports=require("passport-jwt")},function(e,t){e.exports=require("passport-local")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,n){var r=n(3),o=n(2),u=r.Router(),a=n(15),i=n(33),s=n(1).role;u.get("/",o.authenticate("jwt",{session:!1}),i(s.ADMIN),(function(e,t,n){a.getAll().then((function(e){return t.json(e)})).catch((function(e){return n(e)}))})),u.get("/self",o.authenticate("jwt",{session:!1}),(function(e,t,n){a.getById(e.user.id).then((function(e){return e?t.json(e):t.sendStatus(404)})).catch((function(e){return n(e)}))})),u.get("/:id",o.authenticate("jwt",{session:!1}),i(s.ADMIN),(function(e,t,n){var r=e.user;parseInt(e.params.id);if(r.role!==s.ADMIN)return t.status(401).json({message:"Unauthorized"});a.getById(e.params.id).then((function(e){return e?t.json(e):t.sendStatus(404)})).catch((function(e){return n(e)}))})),e.exports=u},function(e,t){e.exports=require("bcrypt")},function(e,t){e.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];"string"==typeof e&&(e=[e]);return[function(t,n,r){if(e.length&&!e.includes(t.user.role))return n.status(401).json({message:"Unauthorized"});r()}]}},function(e,t,n){function r(e,t,n,r,o,u,a){try{var i=e[u](a),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(o,u){var a=e.apply(t,n);function i(e){r(a,o,u,i,s,"next",e)}function s(e){r(a,o,u,i,s,"throw",e)}i(void 0)}))}}var u=n(3),a=n(2),i=u.Router(),s=n(15),c=n(13),l=n(12),f=l.generateAccessToken,p=l.generateRefreshToken,d=n(14).UnauthorizedError;n(35).EvalSourceMapDevToolPlugin;i.post("/register",(function(e,t,n){return m.apply(this,arguments)})),i.post("/login",a.authenticate("login",{session:!1}),(function(e,t,n){return g.apply(this,arguments)})),i.post("/refresh-token",(function(e,t,n){return y.apply(this,arguments)})),i.post("/logout",(function(e,t){return v.apply(this,arguments)})),e.exports=i;var h=function(){var e=o(regeneratorRuntime.mark((function e(t,n,r){var o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=f({id:n._id,role:n.role}),u=p({id:n._id,role:n.role}),e.next=4,c.updateRefreshToken(n._id,r,u);case 4:t.cookie("refresh_token",u,{httpOnly:!0}),t.status(200).json({accessToken:o,user:n});case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();function m(){return(m=o(regeneratorRuntime.mark((function e(t,n,r){var o,u,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=t.body,u=o.username,a=o.email,i=o.password,s.createUser(u,a,i,"","Active").then((function(){return n.status(200).json({message:"Sign up successful."})})).catch((function(e){return r(e)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(){return(g=o(regeneratorRuntime.mark((function e(t,n,r){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{o=t.user,h(n,o,null)}catch(e){r(e)}case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=o(regeneratorRuntime.mark((function e(t,n,r){var o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=t.cookies.refresh_token,e.next=4,c.isValidRefreshToken(o.userId,o);case 4:if(!e.sent){e.next=12;break}return e.next=8,s.getById(userId);case 8:u=e.sent,h(n,u,o),e.next=13;break;case 12:throw new d(401,{message:"Invalid refresh token."});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),r(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function v(){return(v=o(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t.cookies.refresh_token){e.next=4;break}return e.next=4,c.deleteRefreshToken(t.cookies.refresh_token);case 4:n.cookie("refresh_token","",{httpOnly:!0}),n.status(200).end(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),next(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}},function(e,t){e.exports=require("webpack")},function(e,t,n){"use strict";n.r(t);n(26);var r=n(3),o=n.n(r),u=n(0),a=n.n(u),i=n(8),s=n.n(i),c=n(16),l=n.n(c),f=n(17),p=n.n(f),d=n(18),h=n.n(d),m=n(4),g=n.n(m),y=n(19),v=n.n(y),b=n(9),x=n.n(b),w=n(20),k=n(5),S=n(21),O=n(6),j=n(22),E=n.n(j),_=n(23),R=function(e){var t=e.route;return a.a.createElement("div",{className:"container"},Object(O.renderRoutes)(t.routes))};function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,u=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,u=e}finally{try{r||null==i.return||i.return()}finally{if(o)throw u}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var q=function(){var e=T(Object(u.useState)(""),2),t=e[0],n=e[1],r=T(Object(u.useState)(""),2),o=r[0],i=r[1];return a.a.createElement("div",{className:"Home"},a.a.createElement("header",{className:"Home-header"},a.a.createElement("p",null,"Server response below:")),a.a.createElement("p",null,t),a.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:o})};fetch("/api/test",t).then((function(e){return e.json()})).then((function(e){return n(e.message)+" in client"})).catch((function(e){return console.log(e)}))}},a.a.createElement("p",null,a.a.createElement("strong",null,"Post to Server:")),a.a.createElement("input",{type:"text",value:o,onChange:function(e){return i(e.target.value)}}),a.a.createElement("button",{type:"submit"},"Submit")))},I=n(24),P=n.n(I);function N(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,o=!1,u=void 0;try{for(var a,i=e[Symbol.iterator]();!(r=(a=i.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,u=e}finally{try{r||null==i.return||i.return()}finally{if(o)throw u}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function U(e){throw new Error('"'+e+'" is read-only')}var D=[{component:R,routes:[{component:q,path:"/",exact:!0},{component:function(){var e=Object(k.useHistory)(),t=N(Object(u.useState)(""),2),n=t[0],r=t[1],o=N(Object(u.useState)(""),2),i=o[0],s=o[1],c=!1;return a.a.createElement("div",{className:"Home"},a.a.createElement("header",{className:"Home-header"},a.a.createElement("p",null,"User login test page"),c?a.a.createElement("p",{style:{color:"red"}},"authentication failed"):""),a.a.createElement("form",{onSubmit:function(t){t.preventDefault();var r={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:i})};fetch("/api/users/login",r).then((function(e){return e.json()})).then((function(e){return console.log(e)})).catch((function(e){console.log(e),U("authFailure"),c=!0})),e.push("/")}},a.a.createElement("p",null,a.a.createElement("strong",null,"Login:")),a.a.createElement("input",{type:"text",value:n,onChange:function(e){return r(e.target.value)}}),a.a.createElement("input",{type:"text",value:i,onChange:function(e){return s(e.target.value)}}),a.a.createElement("button",{type:"submit"},"Submit")),a.a.createElement("div",null,"test"),a.a.createElement(P.a,{loginUrl:"/api/users/login-twitter-access",onFailure:function(e){return console.log(e)},onSuccess:function(e){return console.log(e)},requestTokenUrl:"/api/users/login-twitter-request"}))},path:"/login",exact:!0}]}],M=n(7);n(25);var z=Object(M.combineReducers)({articles:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"fetch_articles":return t.payload;default:return e}}}),F=n(2),H=n.n(F);n(27);var K=process.env.PORT||3e3,B=o()();B.use(p()()),B.use(l()()),B.use(h()("combined")),B.use(s.a.urlencoded({extended:!1})),B.use(s.a.json()),B.use(o.a.static("public")),B.use(H.a.initialize()),B.use(x()({level:2,filter:function(e,t){return!e.headers["x-no-compression"]&&x.a.filter(e,t)}})),B.post("/api/test",(function(e,t){return t.json({message:e.body.message+" from server"})})),B.use("/api/users",n(31)),B.use("/api/auth",n(34)),B.use(v.a),B.use(/\/((?!api).)*/,(function(e,t){var n={},r=function(e,t,n){var r=Object(w.renderToString)(a.a.createElement(S.Provider,{store:t},a.a.createElement(k.StaticRouter,{location:e.baseUrl,context:n},a.a.createElement("div",null,Object(O.renderRoutes)(D))))),o=_.Helmet.renderStatic();return"<!DOCTYPE html>\n            <head>\n                ".concat(o.title.toString(),"\n                ").concat(o.meta.toString(),"\n                ").concat(o.link.toString(),'\n                <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0"/>\n            </head>\n            <body>\n                <div id="app">').concat(r,"</div>\n                <script>\n                    window.__PRELOADED_STATE__ = ").concat(E()(t.getState()).replace(/</g,"\\u003c"),'\n                <\/script>\n                <script src="/bundle.js"><\/script>\n                <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">\n            </body>\n    </html>')}(e,Object(M.createStore)(z,{}),n);n.notFound&&t.status(404),t.send(r)})),g.a.connect("mongodb://localhost:27017/","sorterGenerator",(function(e){e?(console.log("Unable to connect to Mongo."),process.exit(1)):(B.listen(K,(function(){console.log("Listening on port 3000...")})),process.on("exit",(function(){g.a.close()})))}))}]);
//# sourceMappingURL=bundle.js.map